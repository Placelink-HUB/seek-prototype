<!DOCTYPE html>
<!--
SEEK
Copyright (C) 2025 placelink

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.

=========================================================================

상업적 이용 또는 AGPL-3.0의 공개 의무를 면제받기
위해서는, placelink로부터 별도의 상업용 라이선스(Commercial License)를 구매해야 합니다.
For commercial use or to obtain an exemption from the AGPL-3.0 license
requirements, please purchase a commercial license from placelink.
*** 문의처: help@placelink.shop (README.md 참조)
-->
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>SEEK - Sensitive Entity & Enterprise Keeper</title>

        <link rel="shortcut icon" th:href="@{/public/ico/favicon.ico}" />
        <link rel="stylesheet" th:href="@{/public/css/layout.css}" />
        <link rel="stylesheet" th:href="@{/public/css/style.css}" />
        <link rel="stylesheet" th:href="@{/public/css/s2.loading.css}" />
        <link rel="stylesheet" th:href="@{/public/css/s2.util.css}" />
        <link rel="stylesheet" th:href="@{/public/js/lib/flatpickr/flatpickr.min.css}" />

        <th:block layout:fragment="bodyStyle"></th:block>
        <style>
            .flatpickr-wrapper {
                /* flatpickr 전체를 감싸는 요소 */
                font-family: 'Pretendard', sans-serif;
                font-size: 0.875rem;
            }

            .flatpickr-calendar {
                /* 달력 부분 */
                font-family: 'Pretendard', sans-serif;
                font-size: 0.875rem;
            }

            .flatpickr-day {
                /* 날짜 부분 */
                font-family: 'Pretendard', sans-serif;
                font-size: 0.875rem;
            }
        </style>

        <script th:src="@{/public/js/jquery-3.4.1.min.js}"></script>
        <script th:src="@{/public/js/lib/dayjs.min.js}"></script>
        <script th:src="@{/public/js/lib/flatpickr/flatpickr.min.js}"></script>
        <script th:src="@{/public/js/lib/flatpickr/ko.js}"></script>

        <th:block layout:fragment="bodyScript"></th:block>
        <script type="module">
            import {initializeS2DomEvents} from '[[@{/public/js/s2.util.js}]]';
            document.addEventListener('DOMContentLoaded', () => {
                initializeS2DomEvents();

                const vConsole = '[[${console}]]';
                if (vConsole) {
                    sessionStorage.setItem('console', vConsole);
                }
                const vConsoleType = '[[${consoleType}]]';
                if (vConsoleType) {
                    sessionStorage.setItem('consoleType', vConsoleType);
                } else {
                    sessionStorage.removeItem('consoleType');
                }

                const targetDate = document.querySelector('.targetDate-wrap .targetDate');
                if (targetDate) {
                    let schDe = '[[${schDe}]]';
                    if (schDe) {
                        try {
                            const chkDay = dayjs(schDe, 'YYYYMMDD');
                            if (chkDay.isAfter(dayjs(), 'day')) {
                                schDe = '';
                            }
                        } catch {
                            schDe = '';
                        }
                    }

                    if (!schDe) {
                        schDe = dayjs().format('YYYYMMDD');
                    }

                    const schDay = dayjs(schDe, 'YYYYMMDD');
                    const isToday = schDay.isSame(dayjs(), 'day');

                    targetDate.textContent = schDay.format('YYYY년 MM월 DD일');
                    targetDate.dataset.schDe = schDe;
                    if (isToday) {
                        targetDate.closest('.targetDate-wrap').classList.add('today');
                    } else {
                        targetDate.closest('.targetDate-wrap').classList.remove('today');

                        const arrowRight = document.querySelector('.targetDate-wrap .arrow-right');
                        if (arrowRight) {
                            arrowRight.addEventListener('click', function () {
                                // 다음날로 이동(오늘일때는 다음날로 이동할 수 없다.)
                                const url = new URL(window.location.href);
                                url.searchParams.set('schDe', schDay.add(1, 'day').format('YYYYMMDD'));
                                window.location.href = url.href;
                            });
                        }
                    }

                    const arrowLeft = document.querySelector('.targetDate-wrap .arrow-left');
                    if (arrowLeft) {
                        arrowLeft.addEventListener('click', function () {
                            // 이전날로 이동
                            const url = new URL(window.location.href);
                            url.searchParams.set('schDe', schDay.subtract(1, 'day').format('YYYYMMDD'));
                            window.location.href = url.href;
                        });
                    }
                }

                if (typeof initPage === 'function') {
                    initPage();
                }
            });
        </script>
    </head>
    <body class="hold-transition layout-fixed sidebar-collapse">
        <div class="wrapper">
            <div class="content_wrap">
                <header class="header-wrapper">
                    <th:block th:replace="~{_layout/basic/header :: headerFragment}"></th:block>
                </header>

                <section class="content-wrapper">
                    <div id="main">
                        <div class="sidebar-wrapper">
                            <th:block th:replace="~{_layout/basic/sidebar :: sidebarFragment}"></th:block>
                        </div>
                        <div class="main-contents">
                            <th:block layout:fragment="bodyFragment"></th:block>
                        </div>
                    </div>
                </section>

                <footer class="footer-wrapper">
                    <th:block th:replace="~{_layout/basic/footer :: footerFragment}"></th:block>
                </footer>
            </div>
        </div>
    </body>
</html>
