<!DOCTYPE html>
<!--
SEEK
Copyright (C) 2025 placelink

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.

=========================================================================

상업적 이용 또는 AGPL-3.0의 공개 의무를 면제받기
위해서는, placelink로부터 별도의 상업용 라이선스(Commercial License)를 구매해야 합니다.
For commercial use or to obtain an exemption from the AGPL-3.0 license
requirements, please purchase a commercial license from placelink.
*** 문의처: help@placelink.shop (README.md 참조)
-->
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{_layout/basic/layout}">
    <th:block layout:fragment="bodyStyle"></th:block>
    <th:block layout:fragment="bodyScript">
        <script type="module">
            import {S2Util} from '[[@{/public/js/s2.util.js}]]';

            window.initPage = () => {
                document.querySelectorAll('.btn-coming-soon')?.forEach((btn) => btn.addEventListener('click', () => S2Util.alert('준비 중입니다.')));

                document.querySelector('.btn-download-excel')?.addEventListener('click', () => {
                    S2Util.fetch(
                        '/analysis/sensitive-access-hist/download',
                        {
                            method: 'post',
                            responseType: 'blob',
                            searchStartDe: '[[${searchStartDe}]]',
                            searchEndDe: '[[${searchEndDe}]]'
                        },
                        function () {
                            S2Util.showToast('다운로드 성공');
                        }
                    );
                });
            };

            window.goPage = (pageNo) => {
                location.href = `/public/analysis/sensitive-access-hist?pageNo=${pageNo}`;
            };
        </script>
    </th:block>
    <th:block layout:fragment="bodyFragment">
        <div class="main-contents-contents">
            <div class="wrap-top">
                <h1>
                    <span class="main-title menu4">데이터 복호화 현황</span>
                    <span class="sub-title">PC별 데이터 복호화 처리 현황</span>
                </h1>
                <span class="btn-group">
                    <button class="btn-type1 btn-coming-soon">기간 검색</button>
                    <button class="btn-type1 btn-download-excel">전체 현황 다운로드</button>
                </span>
            </div>
            <div class="wrap-contents">
                <div class="top">
                    <div class="c-flex-sty01 targetDate-wrap">
                        <span th:text="${searchStartDeStr}"></span>
                        <span>&nbsp;~&nbsp;</span>
                        <span th:text="${searchEndDeStr}"></span>
                    </div>
                </div>
                <div class="contents">
                    <div class="status-card">
                        <div class="card type1 white">
                            <div class="title-box menu4-1 padding-left-0">
                                <div class="card-title">복호화 처리 총 건수</div>
                                <div class="card-desc">PC별 복호화 처리 총 합계</div>
                            </div>
                            <div class="card-content"><span th:text="${#numbers.formatInteger(sensitiveInformationUnmaskHistListStatus.totalRequestCount, 0, 'COMMA')}" class="size">0</span> <span class="size-unit">건</span></div>
                        </div>
                        <div class="card type1 mint">
                            <div class="title-box menu4-2">
                                <div class="card-title">정상</div>
                                <div class="card-desc">복호화 요청 이상 없음</div>
                            </div>
                            <div class="card-content"><span th:text="${#numbers.formatInteger(sensitiveInformationUnmaskHistListStatus.normalRequestCount, 0, 'COMMA')}" class="size">0</span> <span class="size-unit">건</span></div>
                        </div>
                        <div class="card type1 tangerine">
                            <div class="title-box menu4-3">
                                <div class="card-title">점검</div>
                                <div class="card-desc">대량 요청 및 비 업무시간 요청</div>
                            </div>
                            <div class="card-content"><span th:text="${#numbers.formatInteger(sensitiveInformationUnmaskHistListStatus.abnormalRequestCount, 0, 'COMMA')}" class="size">0</span> <span class="size-unit">건</span></div>
                        </div>
                        <div class="card type1 red">
                            <div class="title-box menu4-4">
                                <div class="card-title">경고</div>
                                <div class="card-desc">시간/패턴 이상 탐지</div>
                            </div>
                            <div class="card-content"><span class="size">0</span> <span class="size-unit">건</span></div>
                        </div>
                    </div>
                    <h2 class="type1">PC별 복호화 처리 현황</h2>
                    <div class="table-wrap type1 teal-blue">
                        <table class="table-sty01">
                            <caption>
                                PC별 복호화 처리 현황
                            </caption>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>복호화 요청 수</th>
                                    <th>유형</th>
                                    <th>업무시간 요청 수</th>
                                    <th>비업무시간 요청 수</th>
                                    <th>탐지 결과</th>
                                    <th>알림 전송</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:if="${sensitiveInformationUnmaskHistListPagination.isEmpty}">
                                    <td colspan="7">데이터가 없습니다.</td>
                                </tr>
                                <tr th:each="sensitiveInformationUnmaskHist : ${sensitiveInformationUnmaskHistListPagination.dataList}">
                                    <td th:text="${sensitiveInformationUnmaskHist.userId ?: '-'}"></td>
                                    <td th:text="${#numbers.formatInteger(sensitiveInformationUnmaskHist.totalRequestCount, 0, 'COMMA')}"></td>
                                    <td>DB</td>
                                    <td th:text="${#numbers.formatInteger(sensitiveInformationUnmaskHist.normalRequestCount, 0, 'COMMA')}"></td>
                                    <td th:text="${#numbers.formatInteger(sensitiveInformationUnmaskHist.abnormalRequestCount, 0, 'COMMA')}"></td>
                                    <td th:class="${sensitiveInformationUnmaskHist.conditionLevel}" th:text="${sensitiveInformationUnmaskHist.conditionLevel}"></td>
                                    <td>
                                        <button th:if="${sensitiveInformationUnmaskHist.conditionLevel != '정상'}" class="table-btn-sty01 btn-coming-soon">전송</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="pagination-wrapper">
                            <ul th:if="${sensitiveInformationUnmaskHistListPagination.isNotEmpty}" class="pagination">
                                <li th:if="${sensitiveInformationUnmaskHistListPagination.firstPageNoOnPageList gt 1}" class="paginate_button prev">
                                    <a href="#" th:onclick="goPage([[${sensitiveInformationUnmaskHistListPagination.firstPageNoOnPageList - 1}]])">&lt;</a>
                                </li>
                                <th:block th:each="pageNo : ${#numbers.sequence(sensitiveInformationUnmaskHistListPagination.firstPageNoOnPageList, sensitiveInformationUnmaskHistListPagination.lastPageNoOnPageList)}">
                                    <li th:if="${pageNo eq sensitiveInformationUnmaskHistListPagination.pageNo}" class="paginate_button active">
                                        <a href="#" th:text="${pageNo}"></a>
                                    </li>
                                    <li th:if="${pageNo ne sensitiveInformationUnmaskHistListPagination.pageNo}" class="paginate_button">
                                        <a href="#" th:onclick="goPage([[${pageNo}]])" th:text="${pageNo}"></a>
                                    </li>
                                </th:block>
                                <li th:if="${sensitiveInformationUnmaskHistListPagination.lastPageNoOnPageList lt sensitiveInformationUnmaskHistListPagination.lastPageNo}" class="paginate_button next">
                                    <a href="#" th:onclick="goPage([[${sensitiveInformationUnmaskHistListPagination.lastPageNoOnPageList + 1}]])">&gt;</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </th:block>
</html>
